## 封装原函数

`modmain.lua`文件中首先在`AddSimPostInit`函数中给角色绑定了**actionqueuer**组件，并使用一组如下代码对游戏源码中的函数(这里以`OnControl`为例)进行封装,目的是在保证原有函数正常运行的前提下加入自己的修改。

```lua
pc.OnControl = (function()
			local OnControl = pc.OnControl

			return function(self, ...)
				if not (SELECTION_BOX_MODIFIER and _G.TheInput:IsKeyDown(SELECTION_BOX_MODIFIER)) and not (CHERRY_PICKING_MODIFIER and _G.TheInput:IsKeyDown(CHERRY_PICKING_MODIFIER)) then
					return OnControl(self, ...)
				end
			end
		end)()
```

**小记**  
上述函数可以做如下理解。

```lua
local function test(x)
	print("test")
	return x+1
end

--[[
1. 定义匿名函数后，匿名函数函数体使用圆括号括起来，再跟一对圆括号表示立即调用匿名函数，见下述例子func_1;
2. 使用一个变量接收匿名函数的执行结果，匿名函数返回函数则变量为函数类型，见func函数；
3. func函数表示一个调用test函数并返回test执行结果的函数
--]]
func = (function()
			print("func_1")
			return function()
				print("func_2")
				return test(1)
			end
		end
)()
```

## 组件

## 行为树