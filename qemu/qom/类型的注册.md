# 类型的注册

## 函数调用关系

![类型的注册过程](https://github.com/chenyuxiangg/ZLearning/blob/master/qemu/res/%E7%B1%BB%E5%9E%8B%E6%B3%A8%E5%86%8C.png)

## 设计理念

Qemu基于C语言实现，而Qemu想要优雅的模拟各种指令集架构的实现（CPU）以及device和总线之间的关系就需要面向对象的能力。想要用C语言实现面向对象，首先需要解决类型信息的问题，类似C++这类语言，直接使用`class`即可定义一个类的信息，并由编译器在"幕后"将这些类型信息组织起来，而C的编译器没有提供这个能力，因此需要手动维护类型信息，怎么维护呢？说白了关键问题就是如何使用简单的步骤存储类型信息到用户感知不到的地方，并提供一些接口方便用户添加、删除、查询类型的信息。接口的提供比较简单，只要知道在哪存储就能取，所以关键就在于存储类型信息的过程，这个过程需要满足以下几个特性：  

1. 操作简便  
2. 过程透明  
3. 自动建立类关系网  

Qemu给的解决方案非常经典，使用程序运行的底层原理+接口与实现分离的设计模式就解决了这个问题。程序运行
### 上下游关系

## N部曲

从注册一个简单的类型开始，如何测试得到结果需要考虑